<!DOCTYPE html>
<html lang="en">
    <%- include('partials/header'); %>
    <title>Dashboard</title>
</head>
<body>
    <%- include('partials/nav.ejs') %> 
    <div class="container">
        <div>
            <h3>Welcome, <%= firstName %> </h3>
        </div>
        <% if (stories.length!==0) { %>
            <p>Here are your stories</p>
            <table class="highlight responsive-table dash-table">
                <!-- <thead>
                    <tr>
                        <th>Title</th>
                        <th>Date</th>
                        <th>Status</th>
                        <th></th>
                    </tr>
                </thead> -->
                <tbody>
                    <% stories.forEach(el => { %>
                        <tr>
                            <td><a href="stories/<%= el._id %>" ><%= el.title%></a></td>
                            <td><%= formatTime(el.createdAt) %> </td>
                            <td><span class="dash-status"><%= el.status %> </span></td>
                            <td class="table-icons"><a href="stories/edit/<%= el._id %>" ><button type="button" class="submit-button"><i class="fas fa-edit"></i></button></a>
                            <form id="myform" method="POST" action="/stories/<%= el._id %>?_method=DELETE"><button type="button" class="submit-button" onclick="handleDelete()"><i class="fa-solid fa-trash-can delete-icon"></i></button></form></td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } else { %>
            <p>You have not created any stories. Go ahead and create some!</p>
        <% } %>
    </div>
    <%- include('partials/add-btn.ejs') %> 
    <%- include('partials/footer.ejs') %> 
    <script>
        const handleDelete= () => {
            if (confirm("Are you sure you want to delete this?")){
                let form = event.currentTarget.parentNode
                form.submit()
            }
            let button = event.currentTarget
            button.style.backgroundColor="DodgerBlue"
            return false
        }

    </script>
</body>
</html>