<!DOCTYPE html>
<html lang="en">
    <%- include('../partials/header'); %>
    <title>Dashboard</title>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="sweetalert2.all.min.js"></script>
</head>
<body>
    <%- include('../partials/nav-admin.ejs') %> 
    <div class="container">
        <div class="header-box">
                <h5 class="hide-on-small">Users (<%= users.length %> ) </h5>
                <div class="top-right-btns">
                  <a href="#" class="waves-effect waves-purple btn">Create New</a>
                  <a href="#" class="waves-effect waves-light btn">Filter</a>
                </div>
        </div>
        <div id="selected-box" class= "invisible">
          <p>Selected (<span id="numselected"></span>)</p>
          <a class="waves-effect waves-light btn-small hidden" id="deleteAllBtn">Delete</a>
        </div>
        <div class="table-holder">
          <table class="highlight" id="usertable">
            <thead>
              <tr>
                <th>
                  <label>
                    <input type="checkbox" id="all-checkboxes">
                    <span></span>
                  </label>
                </th>
                <th>
                  Email
                </th>
                <th style="cursor: pointer;" id='fname'>
                  First Name
                </th>
                <th>
                  Last Name
                </th>
                <th>
                  Wrote
                </th>
                <th>
                  Liked By
                </th>
                <th>
                  Liked
                </th>
                <th>
                  Joined
                </th>
                <th>
                </th>
              </tr>
            </thead>
          </table>
        </div>

    </div>

    <%- include('../partials/footer.ejs') %> 
    <script src="/js/publicViews.js"></script>
    <script>
      const data = <%- JSON.stringify(users) %>
      fillTable('usertable', data)
      let checkedIds = []

        const checkboxes = document.querySelectorAll(`[id^="sel_"]`)
        const selectAllCheckboxes = document.getElementById('all-checkboxes')
        const selectedBox = document.getElementById('selected-box')
        const numselected = document.getElementById('numselected')
        const deleteAllBtn = document.getElementById('deleteAllBtn')
      
        for (let checkbox of checkboxes){
          if (checkbox.checked === true){//reset all checkboxes when table loads
            checkbox.checked=false
          }
          checkbox.addEventListener('change', function() {
            const checkedId = this.id.split('_')[1]
            if (this.checked) {
              checkedIds.push(checkedId)
            } else {
              checkedIds = checkedIds.filter(el=>el!==checkedId)
            }
            if (checkedIds.length>0){
              selectedBox.classList.remove('invisible')
              deleteAllBtn.classList.remove('hidden')
              numselected.innerHTML = checkedIds.length
            } else {
              selectedBox.classList.add('invisible')
              deleteAllBtn.classList.add('hidden')
            }
          })
          
        }

        selectAllCheckboxes.addEventListener('change', function(){
          if (this.checked){
            checkedIds = []
            for (let checkbox of checkboxes){
              checkbox.checked = true
              const checkedId = checkbox.id.split('_')[1]
              checkedIds.push(checkedId)
            }
            selectedBox.classList.remove('invisible')
            numselected.innerHTML = checkedIds.length
          }
          else {
            for (let checkbox of checkboxes){
              checkbox.checked = false
            }
            checkedIds = []
            selectedBox.classList.add('invisible')
            numselected.innerHTML = checkedIds.length
          }
          
        })

        const sort = (data, col, dir) => {
          window.alert("soring by "+col+" dir="+dir)
        }

        let fnameDir = 1
        const fname = document.getElementById('fname')
        fname.addEventListener('click', ()=>{
          fnameDir *= -1
          sort(data, 'fname', fnameDir)
        })



        const logout = () =>{
                window.location.href = "/auth/logout" 
        }

    </script>

</body>
</html>